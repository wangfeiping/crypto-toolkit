#/bin/bash

#
# curl https://raw.githubusercontent.com/WALL-E/static/master/setup/unknown/install_geth | bash
#
# wget https://raw.githubusercontent.com/WALL-E/static/master/setup/unknown/install_geth -O install_geth
#
# Geth 
#
#

role=`id -u`
if test $role -ne 0
then
    echo "You install geth which requires root privileges"
    exit 1
fi

# Install Geth
cd ~
wget https://gethstore.blob.core.windows.net/builds/geth-linux-amd64-1.10.8-26675454.tar.gz
tar zxvf geth-linux-amd64-1.10.8-26675454.tar.gz
cp geth-linux-amd64-1.10.8-26675454/geth /usr/local/bin/
geth version

# Create goeth user
useradd --system --no-create-home --shell /sbin/nologin goeth


# Create /goethereum directory
mkdir -p /var/lib/goethereum

# Assign goeth permission to modify /goethereum
chown -R goeth:goeth /var/lib/goethereum

# Create geth.service
cat > /etc/systemd/system/geth.service <<EOF
[Unit]
Description=Ethereum go client
After=network.target
Wants=network.target

[Service]
User=goeth
Group=goeth
Type=simple
Restart=always
RestartSec=5
ExecStart=/usr/local/bin/geth --datadir /var/lib/goethereum --syncmode fast --cache 4096 --http --mainnet

[Install]
WantedBy=default.target
EOF

# Reload the daemon
systemctl daemon-reload

# Start geth.service
echo "systemctl start geth"

# Stop geth.service
echo "systemctl stop geth"

# Check geth.service output
echo "journalctl -f -u geth.service"

# Attach to console
echo "geth attach --datadir /var/lib/goethereum"
