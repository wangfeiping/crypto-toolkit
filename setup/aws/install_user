#/bin/bash

#
# curl https://raw.githubusercontent.com/WALL-E/static/master/setup/aws/install_user | bash
#
# wget https://raw.githubusercontent.com/WALL-E/static/master/setup/aws/install_user -O install_user
#
# install lighthouse to AWS Linux 2
#
# Networkï¼šmainnet
#
# Security Rules
# 
# 1. PasswordAuthentication
# 2. DenyUsers
# 3. "!" in the /etc/shadow, The exclamation mark (!) Indicates that the account cannot be logged in


role=`id -u`
if test $role -ne 0
then
    echo "You install Docker which requires root privileges"
    exit 1
fi


# Create user
egrep "^eth-user" /etc/passwd >& /dev/null
if [ $? -ne 0 ]
then
  sudo useradd -m -s /bin/bash eth-user
  passwd -l eth-user
fi

# Disable ssh login
egrep "^eth-user" /etc/ssh/sshd_config >& /dev/null
if [ $? -ne 0 ]
then
  echo "DenyUsers eth-user" >>  /etc/ssh/sshd_config
  
  systemctl restart sshd
fi

echo "SSH Config"
echo "cat /etc/ssh/sshd_config | grep '^PasswordAuthentication'"
echo "cat /etc/ssh/sshd_config | grep '^DenyUsers'"
